language: python
python:
- '3.6'
dist: trusty
before_install:
- wget https://github.com/mozilla/geckodriver/releases/download/v0.19.1/geckodriver-v0.19.1-linux64.tar.gz
- mkdir geckodriver
- tar -xzf geckodriver-v0.19.1-linux64.tar.gz -C geckodriver
- export PATH=$PATH:$PWD/geckodriver
install:
- pip install -r requirements.txt
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- sleep 3
script: aktemplates test tests
notifications:
  slack:
    rooms:
    - moveonorg:LgpahgoMRkw3Pmqnp8Y4xFyI#rebrand-implement
    - moveonorg:LgpahgoMRkw3Pmqnp8Y4xFyI#rebrand-github-log
    on_start: never
    on_success: change
    on_failure: change
    template:
    - Build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>) of %{repository_slug}@%{branch}
      by %{author} %{result} in %{duration}. <https://s3.amazonaws.com/actionkit.moveon.org/test/projects/%{branch}/index.html|rendered>
before_deploy:
- export STATIC_URL=https://static.moveon.org/
- aktemplates runserver --verbosity 0 &>/dev/null &
- sleep 3
- wget --recursive --page-requisites --level=3 --convert-links --html-extension http://localhost:8000/
  || true
deploy:
  on:
    all_branches: true
  provider: s3
  access_key_id: AKIA3AO6RW2Y3RZOP56E
  bucket: actionkit.moveon.org
  skip_cleanup: true
  region: us-east-1
  acl: public_read
  local_dir: localhost:8000
  upload-dir: test/projects/$TRAVIS_BRANCH
  secret_access_key:
    secure: sJQKnjZibJMwqv1ILyKCownHvTpEqbEmfwOlb0vp66M+aKq78PxYOWK1TreL/yb0H78oGZoX7dVKjCCgF0U2B4rBpGcCD/+Vc2v3nPomyEHZpAoESr4j/PzzsY4loOMohWJn0cDeBwWmitXybGo7U7YyDk3NqlG2SkwwFKloSAyIY7IyvhIyOWoY+Wq38O6I/83YpaitJdQm6lrvIFdN5TuS7zYBIXFBE/vQ64upTDqGO64vRuU08aA3F5f3nSDAClfuCJJeBPSolZ6WimDwIhrWcqWOUbv49jZZnenKZnMMh+112P2tYWmE9cKcFN+7H3XZu0ZM3Hws7Nm/HArlW42kAeixEjHkfcobmptx7oquKF20EGmF6kG7V0gPb3ijEfmvLP9/BGXjUxykBHDNoaHcR69sOpBnxrTeXIC1on9LB+oDQwHV3tRb4XcoMLmFqlqcDku+FtYUzsbV5Ia9g7JM/a974nvTHVihtJV7q/XyXIEp6uSqxEhnJHOEGYBYnXwqBR4btEKkA4uroLGTCjKPZco1Tk1h5VzLxqCrzhNFgo3i6H93GDCPcLDyMW8hF/9hQbzVriT8tzeqeUl+oMzpj/gm9/D20bWDch1hrlNbqKBwwg32Mf6m2GAp5Wmtt+a/iSRQYuJmGVtQOuB0BniqtMf0ihXfjS6ic6rjxzo=
